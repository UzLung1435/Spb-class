<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta http-equiv="x-ua-compatible" content="ie=edge"/>
    <title>登录首页</title>
    <!-- MDB icon -->
    <link rel="icon" href="img/mdb-favicon.ico" type="image/x-icon"/>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
    <!-- Google Fonts Roboto -->
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap"/>
    <!-- MDB -->
    <link rel="stylesheet" href="css/mdb.min.css"/>

    <style>
        table {
            width: 70%;
            height: 60%;
            font-size: small;
            overflow-x: auto;
            overflow-y: auto;
        }

        .container {
            display: flex;
            justify-content: center;
        }
    </style>

</head>

<header>
    <!-- Start your project here-->

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-body-tertiary">
        <!-- Container wrapper -->
        <div class="container">
            <!-- Navbar brand -->
            <a class="navbar-brand me-2">
                <img src="./img/stacks_24dp_FILL0_wght400_GRAD0_opsz24.svg" height="16" alt="Stack Logo" loading="lazy"
                     style="margin-top: -1px;"/>
            </a>

            <!-- Toggle button -->
            <button data-mdb-collapse-init class="navbar-toggler" type="button" data-mdb-target="#navbarButtonsExample"
                    aria-controls="navbarButtonsExample" aria-expanded="false" aria-label="Toggle navigation">
                <i class="fas fa-bars"></i>
            </button>

            <!-- Collapsible wrapper -->
            <div class="collapse navbar-collapse" id="navbarButtonsExample">
                <!-- Left links -->
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="#">饲料管理系统</a>
                    </li>
                </ul>
                <!-- Left links -->

                <!--
                <div class="d-flex align-items-center">
                  <button data-mdb-ripple-init type="button" class="btn btn-link px-3 me-2">
                    Login
                  </button>
                  <button data-mdb-ripple-init type="button" class="btn btn-primary me-3">
                    Sign up for free
                  </button>
                  <a data-mdb-ripple-init class="btn btn-dark px-3" href="" role="button"><i class="fab fa-github"></i></a>
                </div>
                -->
            </div>
            <!-- Collapsible wrapper -->
        </div>
        <!-- Container wrapper -->
    </nav>
    <!-- Navbar -->
</header>

<body>

<div style="">
    <div style="width: 60%; height: 40%;">
        <table class="table">
            <thead class="thead-dark">
            <tr>
                <th scope="col">序号</th>
                <th scope="col">中国饲料号CFN</th>
                <th scope="col">饲料名称</th>
                <th scope="col">饲料描述</th>
                <th scope="col">干物质(%)</th>
                <th scope="col">粗蛋白质(%)</th>
                <th scope="col">粗脂肪(%)</th>
                <th scope="col">粗纤维(%)</th>
                <th scope="col">无氮浸出物(%)</th>
                <th scope="col">粗灰分(%)</th>
                <th scope="col">中洗纤维(%)</th>
                <th scope="col">酸洗纤维(%)</th>
                <th scope="col">淀粉(%)</th>
                <th scope="col">钙(%)</th>
                <th scope="col">总磷(%)</th>
                <th scope="col">有效磷(%)</th>
            </tr>
            </thead>
            <tbody id="fodder-table-body">
            <!-- Data will be inserted here -->
            </tbody>
        </table>
    </div>
</div>
<!-- Fodder Modal -->
<!--
<div class="modal fade" id="fodderModal" tabindex="-1" role="dialog" aria-labelledby="fodderModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="fodderModalLabel">Add/Edit Fodder</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="fodder-form">
                    <input type="hidden" id="fodder-id">
                    <div class="md-form">
                        <input type="text" id="fodder-name" class="form-control" required>
                        <label for="fodder-name">Fodder Name</label>
                    </div>
                    <div class="md-form">
                        <input type="number" id="fodder-protein" class="form-control" required>
                        <label for="fodder-protein">Protein</label>
                    </div>
                    <div class="md-form">
                        <input type="number" id="fodder-fat" class="form-control" required>
                        <label for="fodder-fat">Fat</label>
                    </div>
                    <div class="md-form">
                        <input type="number" id="fodder-fiber" class="form-control" required>
                        <label for="fodder-fiber">Fiber</label>
                    </div>
                    <div class="md-form">
                        <input type="number" id="fodder-carbohydrates" class="form-control" required>
                        <label for="fodder-carbohydrates">Carbohydrates</label>
                    </div>
                    <div class="md-form">
                        <input type="number" id="fodder-vitamins" class="form-control" required>
                        <label for="fodder-vitamins">Vitamins</label>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Save</button>
                </form>
            </div>
        </div>
    </div>
</div>
-->
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<!-- Bootstrap JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<!-- MDBootstrap JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.0/js/mdb.min.js"></script>

<script>
    $(document).ready(function () {
        // Fetch and display fodder data
        function fetchFodders() {
            $.ajax({
                url: 'http://localhost:8080/api/fodder/regular/getAllFodders',
                method: 'GET',
                success: function (data) {
                    var tableBody = $('#fodder-table-body');
                    tableBody.empty();
                    data.forEach(function (fodder) {
                        var row = '<tr>' +
                            '<td>' + fodder.CFN + '</td>' +
                            '<td>' + fodder.fodderName + '</td>' +
                            '<td>' + fodder.fodderDescription + '</td>' +
                            '<td>' + fodder.dryMatter + '</td>' +
                            '<td>' + fodder.crudeProtein + '</td>' +
                            '<td>' + fodder.crudeFat + '</td>' +
                            '<td>' + fodder.crudeFiber + '</td>' +
                            '<td>' + fodder.nitrogenFreeExtract + '</td>' +
                            '<td>' + fodder.crudeAsh + '</td>' +
                            '<td>' + fodder.neutralDetergentFiber + '</td>' +
                            '<td>' + fodder.acidDetergentFiber + '</td>' +
                            '<td>' + fodder.starch + '</td>' +
                            '<td>' + fodder.calcium + '</td>' +
                            '<td>' + fodder.totalPhosphorus + '</td>' +
                            '<td>' + fodder.availablePhosphorus + '</td>' +
                            '<td>' +
                            '<button class="btn btn-sm btn-warning edit-fodder" data-id="' + fodder.xid + '">Edit</button> ' +
                            '<button class="btn btn-sm btn-danger delete-fodder" data-id="' + fodder.xid + '">Delete</button>' +
                            '</td>' +
                            '</tr>';
                        tableBody.append(row);
                    });
                },
                error: function (error) {
                    console.log('Error fetching data', error);
                }
            });
        }

        fetchFodders();

        // Add/Edit fodder
        $('#fodder-form').on('submit', function (event) {
            event.preventDefault();
            var id = $('#fodder-id').val();
            var cfn = $('#fodder-cfn').val();
            var name = $('#fodder-name').val();
            var description = $('#fodder-description').val();
            var dryMatter = $('#fodder-dry-matter').val();
            var crudeProtein = $('#fodder-crude-protein').val();
            var crudeFat = $('#fodder-crude-fat').val();
            var crudeFiber = $('#fodder-crude-fiber').val();
            var nfe = $('#fodder-nfe').val();
            var crudeAsh = $('#fodder-crude-ash').val();
            var ndf = $('#fodder-ndf').val();
            var adf = $('#fodder-adf').val();
            var starch = $('#fodder-starch').val();
            var calcium = $('#fodder-calcium').val();
            var totalPhosphorus = $('#fodder-total-phosphorus').val();
            var availablePhosphorus = $('#fodder-available-phosphorus').val();

            var fodderData = {
                CFN: cfn,
                fodderName: name,
                fodderDescription: description,
                dryMatter: dryMatter,
                crudeProtein: crudeProtein,
                crudeFat: crudeFat,
                crudeFiber: crudeFiber,
                nitrogenFreeExtract: nfe,
                crudeAsh: crudeAsh,
                neutralDetergentFiber: ndf,
                acidDetergentFiber: adf,
                starch: starch,
                calcium: calcium,
                totalPhosphorus: totalPhosphorus,
                availablePhosphorus: availablePhosphorus
            };

            var method = id ? 'PUT' : 'POST';
            var url = id ? 'http://localhost:8080/api/fodder/regular/updateFodder/' + id : 'http://localhost:8080/api/fodder/regular/addFodder';

            $.ajax({
                url: url,
                method: method,
                contentType: 'application/json',
                data: JSON.stringify(fodderData),
                success: function (response) {
                    $('#fodderModal').modal('hide');
                    fetchFodders();
                },
                error: function (error) {
                    console.log('Error saving data', error);
                }
            });
        });

        // Populate form for editing
        $(document).on('click', '.edit-fodder', function () {
            var id = $(this).data('id');
            $.ajax({
                url: 'http://localhost:8080/api/fodder/regular/getFodder/' + id,
                method: 'GET',
                success: function (fodder) {
                    $('#fodder-id').val(fodder.xid);
                    $('#fodder-cfn').val(fodder.CFN);
                    $('#fodder-name').val(fodder.fodderName);
                    $('#fodder-description').val(fodder.fodderDescription);
                    $('#fodder-dry-matter').val(fodder.dryMatter);
                    $('#fodder-crude-protein').val(fodder.crudeProtein);
                    $('#fodder-crude-fat').val(fodder.crudeFat);
                    $('#fodder-crude-fiber').val(fodder.crudeFiber);
                    $('#fodder-nfe').val(fodder.nitrogenFreeExtract);
                    $('#fodder-crude-ash').val(fodder.crudeAsh);
                    $('#fodder-ndf').val(fodder.neutralDetergentFiber);
                    $('#fodder-adf').val(fodder.acidDetergentFiber);
                    $('#fodder-starch').val(fodder.starch);
                    $('#fodder-calcium').val(fodder.calcium);
                    $('#fodder-total-phosphorus').val(fodder.totalPhosphorus);
                    $('#fodder-available-phosphorus').val(fodder.availablePhosphorus);
                    $('#fodderModalLabel').text('Edit Fodder');
                    $('#fodderModal').modal('show');
                },
                error: function (error) {
                    console.log('Error fetching fodder', error);
                }
            });
        });

        // Clear form on modal close
        $('#fodderModal').on('hidden.bs.modal', function () {
            $('#fodder-form')[0].reset();
            $('#fodder-id').val('');
            $('#fodderModalLabel').text('Add New Fodder');
        });

        // Delete fodder
        $(document).on('click', '.delete-fodder', function () {
            var id = $(this).data('id');
            $.ajax({
                url: 'http://localhost:8080/api/fodder/regular/deleteFodder/' + id,
                method: 'DELETE',
                success: function (response) {
                    fetchFodders();
                },
                error: function (error) {
                    console.log('Error deleting fodder', error);
                }
            });
        });
    });
</script>